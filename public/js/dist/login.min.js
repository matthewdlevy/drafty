/*! drafty 1.0 2016-09-01 */
var SITES=[{name:"Drafty Docs",markdown_bucket:"drafty-doc-markdown",assets_bucket:"drafty-doc-assets",site_bucket:"drafty-doc-site",aws_region:"us-east-1",datatypes:[],templates:[],menu_template:null}],DEFAULT_DATATYPES=[{id:"html",name:"HTML"},{id:"markdown",name:"Markdown"},{id:"multiples",name:"Multiples"}],DATATYPES=DEFAULT_DATATYPES,DEFAULT_TEMPLATES=[{id:"templates/entry.html",name:"Generic Page"}],TEMPLATES=DEFAULT_TEMPLATES,PARTIALS_PATH="public/js/data-types/partials/",DATA_KEY=".dodgercms/data.json",MENU_TEMPLATE="templates/menu.html",DATA_BUCKET,ASSETS_BUCKET,SITE_BUCKET,AWS_REGION="us-east-1";if(1===SITES.length&&(DATA_BUCKET=SITES[0].markdown_bucket,ASSETS_BUCKET=SITES[0].assets_bucket,SITE_BUCKET=SITES[0].site_bucket,AWS_REGION=SITES[0].aws_region,SITES[0].datatypes))for(var i in SITES[0].datatypes)DATATYPES.push(SITES[0].datatypes[i]);var SITE_ENDPOINT="http://"+SITE_BUCKET+".s3-website-"+AWS_REGION+".amazonaws.com/",CONTENT_TYPE="text/plain; charset=UTF-8",S3_ENDPOINT="s3.amazonaws.com",POOL_ID="us-east-1_csyX70qkT",CLIENT_ID="1ldo9fqfs6e8lm4b6tls1s068p",ID_POOL_ID="us-east-1:9c524e6a-82f3-4c45-a430-44b15e9c5032";$(function(){"use strict";function blockPage(){$.blockUI({css:{border:"none","font-size":"90%",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}})}sessionStorage.removeItem("cognito-token"),AWS.config.region=AWS_REGION,AWSCognito.config.region=AWS_REGION,AWSCognito.config.credentials&&AWSCognito.config.credentials.clearCachedId(),AWSCognito.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:ID_POOL_ID}),AWSCognito.config.update({accessKeyId:"test",secretAccessKey:"test"}),"?verify"==window.location.search&&($("#create-creds").hide(),$("#verify-creds").fadeIn()),$("#create-creds").submit(function(e){e.preventDefault(),blockPage();var userPool=new AWSCognito.CognitoIdentityServiceProvider.CognitoUserPool({UserPoolId:POOL_ID,ClientId:CLIENT_ID}),attributeList=[new AWSCognito.CognitoIdentityServiceProvider.CognitoUserAttribute({Name:"email",Value:$('#create-creds input[name="email"]').val()}),new AWSCognito.CognitoIdentityServiceProvider.CognitoUserAttribute({Name:"name",Value:$('#create-creds input[name="name"]').val()})];userPool.signUp($('#create-creds input[name="user"]').val(),$('#create-creds input[name="pw"]').val(),attributeList,null,function(err,result){return err?(alert(err),void $.unblockUI()):($.unblockUI(),localStorage.setItem("cognito-username",result.user.getUsername()),$("#create-creds").hide(),void $("#verify-creds").fadeIn())})}),$("#verify-creds").submit(function(e){e.preventDefault(),blockPage();var userPool=new AWSCognito.CognitoIdentityServiceProvider.CognitoUserPool({UserPoolId:POOL_ID,ClientId:CLIENT_ID}),userData={Username:localStorage.getItem("cognito-username")||$('#create-creds input[name="user"]').val(),Pool:userPool},cognitoUser=new AWSCognito.CognitoIdentityServiceProvider.CognitoUser(userData);cognitoUser.confirmRegistration($('#verify-creds input[name="code"]').val(),!0,function(err,result){return err?(alert(err),void $.unblockUI()):($.unblockUI(),void window.location.replace(window.location.href.replace("account-creation.html","login.html")))})}),$("#application-login").submit(function(e){e.preventDefault(),blockPage();var userPool=new AWSCognito.CognitoIdentityServiceProvider.CognitoUserPool({UserPoolId:POOL_ID,ClientId:CLIENT_ID}),authenticationData={Username:$('#application-login input[name="user"]').val(),Password:$('#application-login input[name="pw"]').val()},authenticationDetails=new AWSCognito.CognitoIdentityServiceProvider.AuthenticationDetails(authenticationData),userData={Username:$('#application-login input[name="user"]').val(),Pool:userPool},cognitoUser=new AWSCognito.CognitoIdentityServiceProvider.CognitoUser(userData);cognitoUser.authenticateUser(authenticationDetails,{onSuccess:function(result){sessionStorage.setItem("cognito-token",result.getIdToken().getJwtToken());var creds={};creds["cognito-idp."+AWS_REGION+".amazonaws.com/"+POOL_ID]=sessionStorage.getItem("cognito-token"),AWS.config.update({credentials:new AWS.CognitoIdentityCredentials({IdentityPoolId:ID_POOL_ID,Logins:creds})}),$.unblockUI(),window.location.replace(window.location.href.replace("login.html","index.html"))},onFailure:function(err){alert(err),$.unblockUI()}})}),$("#forgotten-password").submit(function(e){e.preventDefault(),blockPage();var userPool=new AWSCognito.CognitoIdentityServiceProvider.CognitoUserPool({UserPoolId:POOL_ID,ClientId:CLIENT_ID}),userData={Username:$('#forgotten-password input[name="user"]').val(),Pool:userPool},cognitoUser=new AWSCognito.CognitoIdentityServiceProvider.CognitoUser(userData),verificationCode=null;$("#forgotten-password").prepend("<p>An email has been sent with verfication information.</p>"),cognitoUser.forgotPassword({onSuccess:function(result){$.unblockUI(),window.location.replace(window.location.href.replace("forgot-password.html","login.html"))},onFailure:function(err){alert(err),$.unblockUI()},inputVerificationCode:function(){$.unblockUI(),verificationCode=window.prompt("Please input verification code ",""),cognitoUser.confirmPassword(verificationCode,$('#forgotten-password input[name="pw"]').val(),this)}})})});